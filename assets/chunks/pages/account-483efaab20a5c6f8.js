(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{5458:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account",function(){return r(4853)}])},4853:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return E}});var n=r(5893),a=r(9008),s=r.n(a),o=r(3490),l=r(8426),i=r(55),c=r(6788),u=r(4277),d=r(8674),h=r(7294),x=r(762),m=r(1919),p=r(5895),g=r(6912),f=r(4952),j=r(4677),Z=r(5678),b=r(7128),y=r(2558),C=r(8537),w=r(5373);let _=e=>{let t=(0,y.a)(),r={...e},a=r.profil_pic,s=a?"".concat("https://liphy-gazotheque.univ-grenoble-alpes.fr/static/","/").concat(a[0]):"",[l,i]=(0,h.useState)([]),[u,d]=(0,h.useState)(!1),_=(0,h.useCallback)(async()=>{if(!l){Z.Am.error("Aucune image s\xe9lectionn\xe9e!",{autoClose:!1});return}let r=new FormData;if(r.append("image",l),!r.has("image")){console.error("Aucun fichier image n'a \xe9t\xe9 ajout\xe9 \xe0 FormData");return}try{let n=await fetch("".concat(b.Z.apiUrl,"/users/upload_pictures/").concat(e.user_id,"/"),{method:"POST",body:r});if(n.ok)Z.Am.success("Image t\xe9l\xe9charg\xe9e avec succ\xe8s",{autoClose:!1}),await t.updateUser(e.user_id),window.location.reload();else{let e=await n.text(),t=JSON.parse(e);Z.Am.error(t.message,{autoClose:!1})}}catch(e){Z.Am.error("Erreur lors du t\xe9l\xe9chargement de l'image: ".concat(e),{autoClose:!1})}},[l,t,e.user_id]);return(0,n.jsxs)(x.Z,{sx:{height:"100%",display:"flex",flexDirection:"column",width:"100%"},children:[(0,n.jsx)(m.Z,{sx:{flexGrow:1},children:(0,n.jsxs)(o.Z,{sx:{alignItems:"center",display:"flex",flexDirection:"column"},children:[(0,n.jsx)(p.Z,{src:s,sx:{height:80,mb:2,width:80}}),(0,n.jsxs)(c.Z,{gutterBottom:!0,variant:"h5",children:[r.first_name," ",r.last_name]}),(0,n.jsx)(c.Z,{color:"text.secondary",variant:"body2",children:r.role}),(0,n.jsx)(c.Z,{color:"text.secondary",variant:"body2",children:r.email})]})}),(0,n.jsx)(g.Z,{}),(0,n.jsxs)(f.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsxs)(j.Z,{variant:"text",component:"label",htmlFor:"upload-button",color:u?"success":"primary",sx:{paddingX:0,display:"flex",alignItems:"center",gap:1,marginRight:1},fullWidth:!0,children:[u?(0,n.jsx)(w.Z,{width:"35px",height:"35px",sx:{color:"success.main"}}):(0,n.jsx)(C.Z,{width:"25px",height:"25px"}),(0,n.jsx)("span",{style:{width:"120px"},children:u?"Fichier s\xe9lectionn\xe9":"Choisir une photo"}),(0,n.jsx)("input",{id:"upload-button",type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files.length>0){let t=e.target.files[0];d(!0),i(t)}else d(!1)},style:{display:"none"}})]}),(0,n.jsx)(j.Z,{onClick:_,variant:"outlined",sx:{py:1.1,justifyContent:"center",textTransform:"none",backgroundColor:"rgb(1, 50, 32)",color:"white","&:hover":{backgroundColor:"rgb(1, 50, 32)"},gap:1,borderColor:"rgb(1, 50, 32)",width:"100%"},fullWidth:!0,children:"T\xe9l\xe9charger photo"})]})]})};var v=r(4375),k=r(2213),A=r(1291);let S=e=>{let t=(0,y.a)(),r=t.session_token,[a,s]=(0,h.useState)({...e}),[l,i]=(0,h.useState)("owner"==a.role),[d,p]=(0,h.useState)({first_name:null,last_name:null,contact:null,role:null}),C=(0,h.useCallback)(e=>{s(t=>({...t,[e.target.name]:e.target.value}))},[]),w=(0,h.useCallback)(async n=>{n.preventDefault(),d.role=l?"owner":"user";try{let n=await fetch("".concat(b.Z.apiUrl,"/users/").concat(e.user_id,"/"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:r},body:JSON.stringify(d)});if(n.ok){let e=await n.json();await t.updateUser(e.user_id),Z.Am.success("Your information was successfully updated!"),window.location.reload()}else{let e=await n.text(),r=JSON.parse(e);"Session expired"===r.error?(Z.Am.error("Your session has expired. Please log in again.",{autoClose:!1}),setTimeout(()=>{t.signOut()},3e3)):"User not found"===r.message?Z.Am.error("User not found. Please try again.",{autoClose:!1}):"Session token not found"===r.message?Z.Am.error("Session token not found. Please try again.",{autoClose:!1}):Z.Am.error("An error occurred. Please try again later.",{autoClose:!1})}}catch(e){console.error("An unexpected error occurred:",e),Z.Am.error("An unexpected error occurred. Please try again later.",{autoClose:!1})}},[d,l,e,t,r]);return(0,h.useEffect)(()=>{p({first_name:a.first_name,last_name:a.last_name,contact:a.owner_contact,role:a.role})},[a]),(0,n.jsx)("form",{autoComplete:"off",noValidate:!0,onSubmit:w,children:(0,n.jsxs)(x.Z,{children:[(0,n.jsx)(v.Z,{subheader:"Les informations peuvent \xeatre modifi\xe9es",title:"Profil"}),(0,n.jsx)(m.Z,{sx:{pt:0},children:(0,n.jsx)(o.Z,{sx:{m:-1.5},children:(0,n.jsxs)(u.Z,{container:!0,spacing:3,children:[(0,n.jsx)(u.Z,{xs:12,md:6,children:(0,n.jsx)(k.Z,{fullWidth:!0,label:"Pr\xe9nom",name:"first_name",onChange:C,value:a.first_name})}),(0,n.jsx)(u.Z,{xs:12,md:6,children:(0,n.jsx)(k.Z,{fullWidth:!0,label:"Nom",name:"last_name",onChange:C,value:a.last_name})}),(0,n.jsx)(u.Z,{xs:12,md:6,children:(0,n.jsx)(k.Z,{fullWidth:!0,label:"Email Adresse",name:"email",onChange:C,disabled:!0,value:a.email})}),l?(0,n.jsx)(u.Z,{xs:12,md:6,children:(0,n.jsx)(k.Z,{type:"number",fullWidth:!0,label:"T\xe9l\xe9phone",name:"owner_contact",onChange:C,value:a.owner_contact,placeholder:"Ex. 0612354525",InputLabelProps:{shrink:!0}})}):null,(0,n.jsxs)(u.Z,{xs:12,md:6,children:[(0,n.jsx)(A.Z,{checked:l,onChange:()=>{i(!l)},color:"primary",inputProps:{"aria-label":"toggle checkbox"}}),(0,n.jsx)(c.Z,{variant:"caption",color:"textSecondary",children:"Activer le compte du propri\xe9taire"})]})]})})}),(0,n.jsx)(g.Z,{}),(0,n.jsx)(f.Z,{sx:{justifyContent:"flex-end"},children:(0,n.jsx)(j.Z,{type:"submit",variant:"contained",sx:{py:1.1,justifyContent:"center",textTransform:"none",backgroundColor:"rgb(1, 50, 32)",color:"white","&:hover":{backgroundColor:"rgb(1, 50, 32)"},gap:1,borderColor:"rgb(1, 50, 32)"},children:"Enregistrer les d\xe9tails"})})]})})},P=()=>{let e=(0,y.a)().user;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s(),{children:(0,n.jsx)("title",{children:"Compte | Gazotheque"})}),(0,n.jsx)(o.Z,{component:"main",sx:{flexGrow:1,py:8},children:(0,n.jsx)(l.Z,{maxWidth:"lg",children:(0,n.jsxs)(i.Z,{spacing:3,children:[(0,n.jsx)("div",{children:(0,n.jsx)(c.Z,{variant:"h4",children:"Compte"})}),(0,n.jsx)("div",{children:(0,n.jsxs)(u.Z,{container:!0,spacing:3,children:[(0,n.jsx)(u.Z,{xs:12,md:6,lg:4,children:(0,n.jsx)(_,{...e})}),(0,n.jsx)(u.Z,{xs:12,md:6,lg:8,children:(0,n.jsx)(S,{...e})})]})})]})})})]})};P.getLayout=e=>(0,n.jsx)(d.A,{children:e});var E=P}},function(e){e.O(0,[103,734,664,151,277,96,649,369,2,674,888,774,179],function(){return e(e.s=5458)}),_N_E=e.O()}]);