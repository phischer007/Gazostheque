"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[822],{7966:function(e,l,a){a.d(l,{Z:function(){return D}});var t=a(5893),i=a(7294),r=a(1163),n=a(8745),s=a(9783),o=a(720),u=a(762),d=a(4375),c=a(1919),h=a(3490),m=a(6788),x=a(4277),v=a(2213),p=a(7521),b=a(96),j=a(923),y=a(1873),g=a(4723),Z=a(4952),f=a(4677),C=a(1589),M=a(733),I=a.n(M);let w=e=>{let{message:l}=e;return(0,t.jsxs)(u.Z,{style:{position:"fixed",top:75,right:20,padding:5,display:"flex",alignItems:"center",zIndex:9999},sx:{borderRadius:1,height:40,width:100},children:[(0,t.jsx)(I(),{type:"spin",color:"blue",height:20,width:20}),(0,t.jsxs)(m.Z,{variant:"caption",style:{marginLeft:5},children:[l,"..."]})]})};var _=a(389),k=a(9332),S=a(7128),O=a(381),E=a.n(O);let P=e=>{let l=(0,k.useRouter)(),[a,t]=(0,i.useState)(null),[r,n]=(0,i.useState)(null),[s,o]=(0,i.useState)(!1),[u,d]=(0,i.useState)(new Date),[c,h]=(0,i.useState)([]),[m,x]=(0,i.useState)({material_title:null,team:"",owner:null,origin:null,codeCommande:null,codeBarres:null,size:null,levRisk:null,lab_destination:null,date_arrivee:null}),[v,p]=(0,i.useState)({status:null,value:""}),[b,j]=(0,i.useState)({title:!1,owner:!1,origin:!1,team:!1,lab_destination:!1}),y=(0,i.useCallback)(e=>{x(l=>({...l,[e.target.name]:e.target.value}))},[]),g=(0,i.useCallback)((e,l)=>{n(l)},[]),Z=(0,i.useCallback)(async e=>{e.preventDefault(),o(!0);let a={title:null===m.material_title,owner:null===r,origin:null===m.origin,team:null===m.team,lab_destination:null===m.lab_destination};if(j(a),!Object.values(a).some(e=>e)){let e=new FormData,a=[{key:"material_title",value:m.material_title},{key:"owner",value:r.owner_id},{key:"team",value:m.team},{key:"origin",value:m.origin},{key:"codeCommande",value:m.codeCommande},{key:"codeBarres",value:m.codeBarres},{key:"size",value:m.size},{key:"levRisk",value:m.levRisk},{key:"lab_destination",value:m.lab_destination},{key:"date_arrivee",value:m.date_arrivee?E()(m.date_arrivee).format("YYYY-MM-DD"):null}];c.forEach(l=>{e.append("tags",l)}),a.forEach(l=>{let{key:a,value:t}=l;null!=t&&""!==t&&e.append(a,t)});let t=await fetch("".concat(S.Z.apiUrl,"/materials/create/"),{method:"POST",body:e});if(t.ok){let e=await t.json();p({status:"success",value:"Nouvelle bouteille ajout\xe9e avec succ\xe8s ! Redirection en cours...."}),setTimeout(()=>{l.push("/details/material-detail/".concat(e.material_id))},2e3)}else{let e=JSON.parse(await t.text()),[l]=Object.keys(e);p({status:"error",value:"".concat(l," : ").concat(e[l][0])})}}o(!1)},[m,l,r,c]);return(0,i.useEffect)(()=>{e&&t(e.find(e=>e.is_staff&&e.owner_name.toLowerCase().includes("liphy")))},[e]),{formData:m,message:v,formErrors:b,isUploading:s,selectedOwner:r,onSelectChange:g,handleChange:y,handleSubmit:Z,handleDateChange:e=>{d(e),x(l=>({...l,date_arrivee:e}))},tags:c,handleAddTag:e=>{e.trim()&&!c.includes(e.trim())&&h([...c,e.trim()])},handleDeleteTag:e=>{h(c.filter(l=>l!==e))}}};var R=a(2357),D=(0,r.withRouter)(e=>{let l=(0,n.Z)(),a=e.ownersList?Object.values(e.ownersList):[],[r,M]=(0,i.useState)(""),{formData:I,message:k,formErrors:S,isUploading:O,selectedOwner:E,onSelectChange:D,handleChange:L,handleSubmit:A,handleDateChange:T,tags:W,handleAddTag:q,handleDeleteTag:z}=P(a);return(0,t.jsxs)("form",{autoComplete:"off",noValidate:!0,onSubmit:A,children:[(0,t.jsxs)(u.Z,{children:[(0,t.jsx)(d.Z,{subheader:"Completez les informations"}),(0,t.jsxs)(c.Z,{sx:{pt:2},children:[(0,t.jsx)(h.Z,{sx:{display:"flex",alignItems:"center",mb:2},children:(0,t.jsx)(m.Z,{variant:"overline",children:"Informations g\xe9n\xe9rales"})}),(0,t.jsxs)(x.Z,{container:!0,spacing:3,children:[(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsx)(v.Z,{fullWidth:!0,label:"Composition du gaz",name:"material_title",onChange:L,type:"text",required:!0,error:S.title})}),(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:a&&(0,t.jsx)(p.Z,{required:!0,options:a,getOptionLabel:e=>e.owner_name,value:E,onChange:D,renderInput:e=>(0,t.jsx)(v.Z,{...e,variant:"standard",label:"Nom du responsable",margin:"normal",error:S.owner,sx:{marginTop:0},fullWidth:!0})})}),(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(b.Z,{fullWidth:!0,labelId:"equipe-select",name:"team",value:I.team,onChange:L,MenuProps:{PaperProps:{style:{maxHeight:"200px",overflowY:"auto"}}},sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:S.team?"red":null},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"}}},displayEmpty:!0,renderValue:e=>(0,t.jsx)(m.Z,{variant:"subtitle2",style:{fontFamily:"inherit",color:e?"inherit":l.palette.text.secondary},children:e||"Choisir une \xe9quipe"}),children:[(0,t.jsxs)(j.Z,{value:"",children:[" ",(0,t.jsx)("em",{children:"R\xe9initialiser"})," "]}),[{value:"BIOP",label:"BIOP"},{value:"ECCEL",label:"ECCEL"},{value:"LAME",label:"LAME"},{value:"MICROTISS",label:"MICROTISS"},{value:"MOVE",label:"MOVE"},{value:"MC2",label:"MC2"},{value:"PSM",label:"PSM"},{value:"MODI",label:"MODI"},{value:"OPTIMA",label:"OPTIMA"},{value:"Atelier",label:"Atelier"},{value:"M2Bio",label:"M2Bio"},{value:"MicroFab",label:"MicroFab"}].map((e,l)=>(0,t.jsx)(j.Z,{value:e.value,children:e.label},l))]})}),(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsx)(v.Z,{fullWidth:!0,label:"Salle de stockage",name:"origin",error:S.origin,onChange:L,type:"text",required:!0})})]})]}),(0,t.jsxs)(c.Z,{children:[(0,t.jsx)(h.Z,{sx:{display:"flex",alignItems:"center",mb:2},children:(0,t.jsx)(m.Z,{variant:"overline",children:"Tags"})}),(0,t.jsx)(x.Z,{container:!0,spacing:3,children:(0,t.jsxs)(x.Z,{item:!0,xs:12,children:[(0,t.jsx)(v.Z,{fullWidth:!0,label:"Ajouter des tags",value:r,onChange:e=>M(e.target.value),onKeyDown:e=>{"Enter"===e.key&&r.trim()&&(e.preventDefault(),q(r.trim()),M(""))},helperText:"Appuyez sur Entr\xe9e pour ajouter un tag"}),(0,t.jsx)(h.Z,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:1},children:W.map((e,a)=>(0,t.jsx)(y.Z,{label:e,onDelete:()=>z(e),sx:{backgroundColor:l.palette.primary.light,color:"white","& .MuiChip-deleteIcon":{color:"white"}}},a))})]})})]}),(0,t.jsxs)(c.Z,{children:[(0,t.jsx)(h.Z,{sx:{display:"flex",alignItems:"center",mb:2},children:(0,t.jsx)(m.Z,{variant:"overline",children:"Caract\xe9ristiques de la bouteille"})}),(0,t.jsxs)(x.Z,{container:!0,spacing:3,children:[(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsx)(v.Z,{fullWidth:!0,label:"Code commande Air Liquide",name:"codeCommande",value:I.codeCommande,onChange:L,type:"text",required:!0})}),(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsx)(v.Z,{fullWidth:!0,label:"Code barres Air Liquide",name:"codeBarres",value:I.codeBarres,onChange:L,type:"text",required:!0})}),(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(b.Z,{fullWidth:!0,labelId:"taille-select",name:"size",value:I.size,onChange:L,MenuProps:{PaperProps:{style:{maxHeight:"200px",overflowY:"auto"}}},displayEmpty:!0,renderValue:e=>(0,t.jsx)(m.Z,{variant:"subtitle2",style:{fontFamily:"inherit",color:e?"inherit":l.palette.text.secondary},children:e||"Choisir la taille de la bouteille"}),children:[(0,t.jsxs)(j.Z,{value:"",children:[" ",(0,t.jsx)("em",{children:"R\xe9initialiser"})," "]}),[{value:"S02",label:"S02"},{value:"S05",label:"S05"},{value:"S11",label:"S11"},{value:"M20",label:"M20"},{value:"L50",label:"L50"},{value:"Cartouche",label:"Cartouche"}].map((e,l)=>(0,t.jsx)(j.Z,{value:e.value,children:e.label},l))]})}),(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(b.Z,{fullWidth:!0,labelId:"risque-select",name:"levRisk",value:I.levRisk,onChange:L,MenuProps:{PaperProps:{style:{maxHeight:"200px",overflowY:"auto"}}},displayEmpty:!0,renderValue:e=>(0,t.jsx)(m.Z,{variant:"subtitle2",style:{fontFamily:"inherit",color:e?"inherit":l.palette.text.secondary},children:e||"Risque associ\xe9 \xe0 la bouteille"}),children:[(0,t.jsxs)(j.Z,{value:"",children:[" ",(0,t.jsx)("em",{children:"R\xe9initialiser"})," "]}),[{value:"Gaz neutre",label:"Gaz neutre"},{value:"Inflammable",label:"Inflammable"},{value:"Comburant",label:"Comburant"}].map((e,l)=>(0,t.jsx)(j.Z,{value:e.value,children:e.label},l))]})}),(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsx)(o._,{dateAdapter:R.H,children:(0,t.jsx)(s.M,{label:"Date d'arriv\xe9e",format:"dd/MM/yyyy",value:I.date_arrivee,onChange:T,slotProps:{textField:{helperText:"DD/MM/YYYY",fullWidth:!0}}})})}),(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(b.Z,{fullWidth:!0,labelId:"lab-destination-select",name:"lab_destination",value:I.lab_destination,onChange:L,MenuProps:{PaperProps:{style:{maxHeight:"200px",overflowY:"auto"}}},sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:S.lab_destination?"red":null},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"}}},displayEmpty:!0,renderValue:e=>(0,t.jsx)(m.Z,{variant:"subtitle2",style:{fontFamily:"inherit",color:e?"inherit":l.palette.text.secondary},children:e||"Associer la bouteille \xe0 un laboratoire"}),children:[(0,t.jsxs)(j.Z,{value:"",children:[" ",(0,t.jsx)("em",{children:"R\xe9initialiser"})," "]}),[{value:"LIPhy",label:"LIPhy"},{value:"IGE",label:"IGE"}].map((e,l)=>(0,t.jsx)(j.Z,{value:e.value,children:e.label},l))]})})]})]}),k&&k.status&&(0,t.jsx)(x.Z,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(g.Z,{severity:k.status,children:[" ",k.value]})})]}),(0,t.jsx)(u.Z,{children:(0,t.jsxs)(Z.Z,{sx:{justifyContent:"flex-end"},children:[(0,t.jsx)(f.Z,{fullWidth:!0,variant:"contained",type:"submit",startIcon:(0,t.jsx)(C.Z,{fontSize:"small",children:(0,t.jsx)(_.Z,{})}),sx:{py:1.1,justifyContent:"center",textTransform:"none",backgroundColor:"rgb(1, 50, 32)",color:"white","&:hover":{backgroundColor:"rgb(1, 50, 32)"},gap:1,borderColor:"rgb(1, 50, 32)"},children:"Enregistrer"}),O&&(0,t.jsx)(w,{message:"Enregistrement..."})]})})]})})}}]);